'''
Based on the National Hurricane Center's hurricane database format for a
specific date/time/location. This module is part of the Hurdat2FC repository
by Paul Schrum.

Each instance of HurricaneTrack contains all records for that hurricane. It
represents the hurricane for its entire lifetime.
'''

__author__ = 'Paul Schrum'

from HurricaneRecord import HurricaneRecord

class HurricaneTrack():
    def __init__(self, rec_list):
        hdr_row = [s.strip() for s in rec_list[0].split(',')]
        self.designation = hdr_row[0]
        self.name = hdr_row[1]
        self.record_count = int(hdr_row[2])
        self.record_dict = {}
        for a_record in rec_list[1:]:
            a_rec = HurricaneRecord(a_record)
            rec_time = a_rec.record_time
            self.record_dict[rec_time] = a_rec

        self.max_wind_speed = max([r.max_sustained_wind for r in
                                   self.record_dict.values()])
        self.min_bar_pressure = min([r.min_pressure for r in
                                   self.record_dict.values()])

        self.start_time = min(self.record_dict)
        a_record: HurricaneRecord
        for a_record in self.record_dict.values():
            a_record.set_track_start_time(self.start_time)


    def __repr__(self):
        return str(self.start_time.year) + ' ' + str(self.start_time.month) \
                + ' ' + str(self.start_time.day) + ' ' + self.name

    @property
    def unique_name(self):
        return self.__repr__()

    @property
    def end_time(self):
        return list(self.record_dict.keys())[-1]

    @property
    def shape(self):
        '''
        List of coordinate pairs (tuples)
        :return: List of coordinate pairs (tuples)
        '''
        return [r.coords for r in self.record_dict.values()]

if __name__ == '__main__':
    testRecords = \
'''
AL061996,               FRAN,     72,
19960823, 1200,  , TD, 14.0N,  21.0W,  25, 1012, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960823, 1800,  , TD, 14.1N,  22.8W,  25, 1011, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960824, 0000,  , TD, 14.2N,  24.8W,  25, 1010, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960824, 0600,  , TD, 14.2N,  26.6W,  30, 1009, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960824, 1200,  , TD, 14.1N,  28.2W,  30, 1009, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960824, 1800,  , TD, 14.1N,  29.6W,  30, 1009, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960825, 0000,  , TD, 14.1N,  30.8W,  25, 1009, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960825, 0600,  , TD, 14.3N,  32.0W,  25, 1009, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960825, 1200,  , TD, 14.6N,  33.4W,  25, 1009, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960825, 1800,  , TD, 14.7N,  35.1W,  25, 1009, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960826, 0000,  , TD, 14.9N,  37.0W,  25, 1009, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960826, 0600,  , TD, 15.1N,  38.6W,  25, 1009, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960826, 1200,  , TD, 15.3N,  40.0W,  30, 1009, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960826, 1800,  , TD, 15.2N,  41.4W,  30, 1008, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960827, 0000,  , TD, 14.9N,  42.7W,  30, 1007, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960827, 0600,  , TD, 14.7N,  43.8W,  30, 1006, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960827, 1200,  , TS, 14.6N,  44.9W,  35, 1005, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960827, 1800,  , TS, 14.6N,  46.1W,  40, 1004, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960828, 0000,  , TS, 14.6N,  47.5W,  45, 1002, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960828, 0600,  , TS, 15.0N,  49.1W,  50, 1000, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960828, 1200,  , TS, 15.5N,  50.7W,  55,  995, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960828, 1800,  , TS, 15.9N,  52.3W,  60,  990, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960829, 0000,  , HU, 16.4N,  53.7W,  65,  987, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960829, 0600,  , HU, 17.0N,  55.0W,  65,  987, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960829, 1200,  , HU, 17.8N,  56.3W,  65,  988, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960829, 1800,  , HU, 18.6N,  57.5W,  65,  988, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960830, 0000,  , HU, 19.1N,  58.5W,  65,  991, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960830, 0600,  , HU, 19.4N,  59.4W,  65,  991, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960830, 1200,  , HU, 19.8N,  60.1W,  65,  989, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960830, 1800,  , TS, 20.2N,  60.6W,  60,  990, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960831, 0000,  , TS, 20.5N,  60.9W,  60,  988, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960831, 0600,  , TS, 20.8N,  61.2W,  60,  987, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960831, 1200,  , HU, 21.1N,  61.4W,  65,  984, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960831, 1800,  , HU, 21.5N,  61.7W,  65,  983, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960901, 0000,  , HU, 21.7N,  62.1W,  65,  978, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960901, 0600,  , HU, 21.9N,  62.6W,  65,  982, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960901, 1200,  , HU, 22.2N,  63.2W,  70,  982, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960901, 1800,  , HU, 22.5N,  63.9W,  75,  981, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960902, 0000,  , HU, 22.9N,  64.7W,  75,  978, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960902, 0600,  , HU, 23.3N,  65.7W,  75,  976, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960902, 1200,  , HU, 23.6N,  66.7W,  75,  976, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960902, 1800,  , HU, 23.9N,  67.9W,  75,  976, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960903, 0000,  , HU, 24.2N,  69.0W,  75,  977, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960903, 0600,  , HU, 24.4N,  70.1W,  80,  975, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960903, 1200,  , HU, 24.7N,  71.2W,  80,  973, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960903, 1800,  , HU, 25.2N,  72.2W,  85,  968, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960904, 0000,  , HU, 25.7N,  73.1W,  95,  961, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960904, 0600,  , HU, 26.4N,  73.9W, 100,  953, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960904, 1200,  , HU, 27.0N,  74.7W, 105,  956, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960904, 1800,  , HU, 27.7N,  75.5W, 105,  952, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960905, 0000,  , HU, 28.6N,  76.1W, 105,  946, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960905, 0600,  , HU, 29.8N,  76.7W, 105,  952, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960905, 1200,  , HU, 31.0N,  77.2W, 100,  954, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960905, 1800,  , HU, 32.3N,  77.8W, 100,  952, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960906, 0000,  , HU, 33.7N,  78.0W, 100,  954, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960906, 0030, L, HU, 33.9N,  78.0W, 100,  954, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960906, 0600,  , HU, 35.2N,  78.7W,  65,  970, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960906, 1200,  , TS, 36.7N,  79.0W,  40,  985, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960906, 1800,  , TD, 38.0N,  79.4W,  30,  995, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960907, 0000,  , TD, 39.2N,  79.9W,  30, 1000, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960907, 0600,  , TD, 40.4N,  80.4W,  30, 1001, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960907, 1200,  , TD, 41.2N,  80.5W,  30, 1001, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960907, 1800,  , TD, 42.0N,  80.4W,  30, 1000, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960908, 0000,  , TD, 42.8N,  80.1W,  30,  999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960908, 0600,  , TD, 43.4N,  79.9W,  30,  999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960908, 1200,  , TD, 44.0N,  79.0W,  25, 1000, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960908, 1800,  , TD, 44.5N,  77.6W,  25, 1001, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960909, 0000,  , EX, 44.9N,  75.9W,  25, 1002, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960909, 0600,  , EX, 45.4N,  74.0W,  20, 1004, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960909, 1200,  , EX, 45.7N,  72.3W,  15, 1006, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960909, 1800,  , EX, 46.0N,  71.1W,  15, 1008, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
19960910, 0000,  , EX, 46.7N,  70.0W,  15, 1010, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999, -999,
'''
    test_rec_list = testRecords.split('\n')[1:-1]

    a_hurricane = HurricaneTrack(test_rec_list)
    assert a_hurricane
    import math
    assert math.isclose(105.0, a_hurricane.max_wind_speed, abs_tol=0.01)

    print("All __main__ tests passed.")
